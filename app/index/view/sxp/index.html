<!DOCTYPE html>
<html>
<head>
    <title>{$class1}</title>
    <meta charset="utf-8">
    <script src="__IMAGES__/jquery.min.js"></script>
    <link rel="stylesheet" href="__LAYUI__/css/layui.css">
    <script src="__LAYUI__/layui.js"></script>
    <style>
        .layui-table th{
            text-align: center;
        }
        .layui-table td{
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-col-xs12">
            <div class="layui-card">
                {include file="public/top"/}
                <div class="layui-card-header">
                    一肖/尾数
                    <span style="padding-left: 40px;">距离封盘时间：<b class="time" style="color: red;font-weight: normal;"></b></span>
                </div>
                <div class="layui-card-body">
                    <form action="{:url('bets/kbbSubmit')}" id="form1" method="post">
                        <input type="hidden" name="class2" value="{$ids}">
                        <table class="layui-table">
                            <colgroup>
                                <col width="60">
                                <col width="75">
                                <col width="115">
                                <col width="30%">
                                <col width="60">
                                <col width="75">
                                <col width="115">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th colspan="8">一  肖（特平肖）</th>
                            </tr>
                            </thead>
                            <tbody>
                            {for start="0" end="6"}
                            <tr>
                                <td class="td{$i}">{$res[$i]['class3']}</td>
                                <td class="td{$i}"><span id="bl{$res[$i]['id']}" style="font-weight: bold;color: red;"> 0 </span></td>
                                <td class="td{$i}"><input type="text" class="layui-input input1" style="width: 100px;" placeholder="￥" name="Num_{$i+1}" sum="{:getTanKitheSum($classa1,$classa2,$res1[$i]['class3'])}">
                                    <input name="class3_{$i+1}" value="{$res[$i]['class3']}" type="hidden" >
                                    <input name="gb{$i+1}" type="hidden"  value="0">
                                    <input name="xr_{$i}" type="hidden" id="xr_{$i}" value="0" >
                                    <input name="xrr_{$i+1}" type="hidden"  value="0" >
                                </td>
                                <td class="td{$i}">
                                    {foreach name="res[$i]['m_number']" id="m"}
                                    <img src="__IMAGES__/num{$m}.gif" style="padding-right: 5px;"/>
                                    {/foreach}
                                </td>
                                <td class="td{$i+6}">{$res[$i+6]['class3']}</td>
                                <td class="td{$i+6}"><span id="bl{$res[$i+6]['id']}" style="font-weight: bold;color: red;"> 0 </span></td>
                                <td class="td{$i+6}">
                                    <input type="hidden" name="xc" value="{$xc}">
                                    <input class="layui-input input1" style="width: 100px;" placeholder="￥" size="4" name="Num_{$i+1+6}" sum="{:getTanKitheSum($classa1,$classa2,$res1[$i]['class3'])}">
                                    <input name="class3_{$i+1+6}" value="{$res[$i+6]['class3']}" type="hidden" >
                                    <input name="gb{$i+1+6}" type="hidden"  value="0">
                                    <input name="xr_{$i+6}" type="hidden" id="xr_{$i+6}" value="0" >
                                    <input name="xrr_{$i+1+6}" type="hidden"  value="0" >
                                </td>
                                <td class="td{$i+6}">
                                    {foreach name="res[$i+6]['m_number']" id="m"}
                                    <img src="__IMAGES__/num{$m}.gif"  style="padding-right: 5px;"/>
                                    {/foreach}
                                </td>
                            </tr>
                            {/for}
                            <tr>
                                <td colspan="8" align="center">
                                    <input type="hidden" value="0" name="gold_all" id="total_gold">
                                    <input type="hidden" name="from_url" value="{:url('')}">
                                    <div class="layui-inline" style="padding: 0 30px 0 0;">下注金额：  <span id="allgold">0</span></div>
                                    <button class="layui-btn layui-btn-sm" id="btnSubmit">提交</button>
                                    <button type="reset" class="layui-btn layui-btn-sm">重设</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                    <form action="{:url('bets/kbbSubmit')}" id="form2" method="post">
                        <input type="hidden" name="class2" value="正特尾数">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th colspan="15">尾  数（平特尾）</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                {for start="0" end="5"}
                                    <td class="td{$i+15}">{$res1[$i]['class3']}尾</td>
                                    <td class="td{$i+15}"><span id="bl{$res1[$i]['id']}" style="font-weight: bold;color: red;"> 0 </span></td>
                                    <td class="td{$i+15}">
                                        <input class="input2 layui-input" style="width: 100px;" placeholder="￥" size="5" name="Num_{$i+1}" sum="{:getTanKitheSum($classa1,$classa2,$res1[$i]['class3'])}"/>
                                        <input name="class3_{$i+1}" value="{$i+1}" type="hidden" />
                                        <input name="gb{$i+1}" type="hidden"  value="0" />
                                        <input name="xr_{$i}" type="hidden" id="xr_0" value="0" />
                                        <input name="xrr_{$i+1}" type="hidden"  value="0" />
                                    </td>
                                {/for}
                            </tr>
                            <tr>
                                {for start="5" end="10"}
                                <td class="td{$i+15}">{$res1[$i]['class3']}尾</td>
                                <td class="td{$i+15}"><span id="bl{$res1[$i]['id']}" style="font-weight: bold;color: red;"> 0 </span></td>
                                <td class="td{$i+15}">
                                    <input class="input2 layui-input" placeholder="￥" style="width: 100px;" size="5" name="Num_{$i+1}" sum="{:getTanKitheSum($classa1,$classa2,$res1[$i]['class3'])}"/>
                                    <input name="class3_{$i+1}" value="{$i+1}" type="hidden" />
                                    <input name="gb{$i+1}" type="hidden"  value="0" />
                                    <input name="xr_{$i}" type="hidden" id="xr_0" value="0" />
                                    <input name="xrr_{$i+1}" type="hidden"  value="0" />
                                </td>
                                {/for}
                            </tr>
                            <tr>
                                <td colspan="15" align="center">
                                    <input type="hidden" name="xc" value="{$xc}">
                                    <input type="hidden" name="from_url" value="{:url('')}">
                                    <input type=hidden value=0 name="gold_all" id="total_gold_z">
                                    <div class="layui-inline" style="padding: 0 30px 0 0;">下注金额:<span id="allgold_z">0</span></div>
                                    <button class="layui-btn layui-btn-sm" id="btnSubmit_z">提交</button>
                                    <button type="reset" class="layui-btn layui-btn-sm">重设</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $(function(){
        //远程定时获取指定数据
        function loc(){
            $.ajax({
                url:'{:url('bets/server')}',
                type:'post',
                returnType:'json',
                data:{
                'class1':'{$class1}',
                'class2':'{$ids}'
            },
            success:function(response,status,xhr){
                for (var i=0;i<response.length;i++){
                    var sbbn=i+1;
                    if(response[i].locked==1){
                        $('#bl'+response[i].id).html('停');
                        $('#bl'+response[i].id).parent().parent().next().find('input').attr({disabled:true}).css('background','#F1F1F1');
                    }else{
                        switch('{$abcd}'){
                            case 'A':
                                if(response[i]['rate']!=response[i]['blrate']){
                                    $('#bl'+response[i].id).html(response[i]['rate']);
                                }else{
                                    $('#bl'+response[i].id).html(response[i]['rate']);
                                }
                                break;
                            case 'B':
                                if(response[i]['rate']!=response[i]['blrate']){
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('bbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }else{
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('bbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }
                                break;
                            case 'C':
                                if(response[i]['rate']!=response[i]['blrate']){
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('cbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }else{
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('cbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }
                                break;
                            case 'D':
                                if(response[i]['rate']!=response[i]['blrate']){
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('dbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }else{
                                    var bs=eval(Math.round(response[i]['rate']*100)+"-{:getConfigField('dbb')*100}")/100;
                                    $('#bl'+response[i].id).html(bs);
                                }
                                break;
                            default:
                                if(response[i]['rate']!=response[i]['blrate']){
                                    $('#bl'+response[i].id).html(response[i]['rate']);
                                }else{
                                    $('#bl'+response[i].id).html(response[i]['rate']);
                                }
                                break;
                        }
                    }
                }
            }
        });
            //定时操作
            setTimeout(loc,{$Think.config.ftime});
        }
        loc();      //执行

        layui.use(['layer','form'],function () {
            var layer=layui.layer,
            form=layui.form;

            //表格点击
            $('.layui-table td').hover(function () {
                var className=$(this).attr('class');
                $('.'+className).css({'background-color':'#f2f2f2'});
            },function () {
                var className=$(this).attr('class');
                $('.'+className).removeAttr('style');
            });

            $('.layui-table td').click(function () {
                var className=$(this).attr('class');
                $('.'+className).find('input').focus();
            });

            //表单焦点判断
            $('.input1').on('blur',function(){
                var re = /^[0-9]+\.?[0-9]*$/;
                var value=parseFloat($(this).val());
                var sum=parseFloat($(this).attr('sum'));
                if(!re.test($(this).val()) && $(this).val()!=''){
                    layer.msg('下注金额仅能输入数字',{icon:2});
                    $(this).val('0');
                    value=0;
                }
                if($(this).val()==''){
                    value=0;
                }
                if ( (value < {:getMemField('xy')}) && (value!='')) {$(this).val('0');$(this).focus(); layer.msg("下注金额不可小於最低限度:{:getMemField('xy')}!!",{icon:2}); return false;}
                if (parseFloat(sum+value) > {:getQuotaField($xc,'xxx')}) {$(this).val('0'); $(this).focus(); layer.msg("对不起,号止本期下注金额最高限制 : {:getQuotaField($xc,'xxx')}!!",{icon:2}); return false;}
                if (value > {:getQuotaField($xc,'xx')}) {$(this).val('0');$(this).focus(); layer.msg("对不起,下注金额已超过单注限额 : {:getQuotaField($xc,'xx')}!!",{icon:2}); return false;}

                //下注金额的值
                var money =getAllInput();

                if (money > {:getMemField('ts')}){$(this).val('0');$(this).focus(); layer.msg("下注金额不可大於可用信用额度!!",{icon:2});    return false;}
                $('#allgold').html(money);
                $('#total_gold').val( $('#allgold').html());
            });

            //表单提交
            $('#form1').submit(function(){
                var sum=parseFloat($('#total_gold').val());
                if($('#total_gold').val() == '' || $('#total_gold').val() ==0){
                    layer.msg('下注金额不能为空',{icon:2});
                    return false;
                }
                if(sum<=0){
                    layer.msg('请输入下注金额!!',{icon:2});
                    return false;
                }
                if (sum > {:getMemField('ts')})   {
                    layer.msg("下注金额不可大於可用信用额度!!",{icon:2});
                    return false;
                }
                if (sum < {:getMemField('xy')})   {
                    layer.msg("下注最低限额{:getMemField('xy')}",{icon:2});
                    return false;
                }
                if (sum > {:getQuotaField($xc,'xx')}) {
                    layer.msg("对不起,下注金额已超过单注限额 : {:getQuotaField($xc,'xx')}!!",{icon:2});
                    return false;
                }
                // $('#btnSubmit').addClass('layui-btn-disabled');
                layer.open({
                    type: 2,
                    title: '确认注单',
                    shadeClose: false,
                    shade: 0.3,
                    maxmin: true,
                    area: ['700px', '500px'],
                    content: '{:url("bets/kbbSubmit")}?'+$('#form1').serialize()
                });
                return false;


            });

            $('.input2').on('blur',function(){
                var re = /^[0-9]+\.?[0-9]*$/;
                var value=parseFloat($(this).val());
                var sum=parseFloat($(this).attr('sum'));
                if(!re.test($(this).val()) && $(this).val()!=''){
                    layer.msg('下注金额仅能输入数字',{icon:2});
                    $(this).val('0');
                    value=0;
                }
                if($(this).val()==''){
                    value=0;
                }
                if ( (value < {:getMemField('xy')}) && (value!='')) {$(this).val('0');$(this).focus(); layer.msg("下注金额不可小於最低限度:{:getMemField('xy')}!!",{icon:2}); return false;}
                if (parseFloat(sum+value) > {:getQuotaField($xc,'xxx')}) {$(this).val('0'); $(this).focus(); layer.msg("对不起,号止本期下注金额最高限制 : {:getQuotaField($xc,'xxx')}!!",{icon:2}); return false;}
                if (value > {:getQuotaField($xc,'xx')}) {$(this).val('0');$(this).focus(); layer.msg("对不起,下注金额已超过单注限额 : {:getQuotaField($xc,'xx')}!!",{icon:2}); return false;}

                //下注金额的值
                var money =getAllInput2();
                // console.log(money);
                if (money > {:getMemField('ts')}){$(this).val('0');$(this).focus(); layer.msg("下注金额不可大於可用信用额度!!",{icon:2});    return false;}
                $('#allgold_z').html(money);
                $('#total_gold_z').val( $('#allgold_z').html());
            });

            //表单提交
            $('#form2').submit(function(){
                var sum=parseFloat($('#total_gold_z').val());
                if($('#total_gold_z').val() == '' || $('#total_gold_z').val() ==0){
                    layer.msg('下注金额不能为空',{icon:2});
                    return false;
                }
                if(sum<=0){
                    layer.msg('请输入下注金额!!',{icon:2});
                    return false;
                }
                if (sum > {:getMemField('ts')})   {
                    layer.msg("下注金额不可大於可用信用额度!!",{icon:2});
                    return false;
                }
                if(sum < {:getMemField('xy')}){
                    layer.msg("下注金额不可小於最低限度:{:getMemField('xy')}!!",{icon:2});
                    return false;
                }                if (sum > {:getQuotaField($xc,'xx')}) {
                    layer.msg("对不起,下注金额已超过单注限额 : {:getQuotaField($xc,'xx')}!!",{icon:2});
                    return false;
                }
                // $('#btnSubmit_z').addClass('layui-btn-disabled');
                layer.open({
                    type: 2,
                    title: '确认注单',
                    shadeClose: false,
                    shade: 0.3,
                    maxmin: true,
                    area: ['700px', '500px'],
                    content: '{:url("bets/kbbSubmit")}?'+$('#form2').serialize()
                });
                return false;

            });
        })

        //计算所有的input表单的值
        function getAllInput(){
            $nums=0;
            for (var i=1;i<=$('.input1').length;i++){
                if($('#form1 [name=Num_'+i+']').val()!=''){
                    $nums+=parseFloat($('#form1 [name=Num_'+i+']').val());
                }
            }
            return $nums;
        }
        function getAllInput2(){
            $nums=0;
            for (var i=1;i<=$('.input2').length;i++){
                if($('#form2 [name=Num_'+i+']').val()!=''){
                    $nums+=parseFloat($('#form2 [name=Num_'+i+']').val());
                }
            }
            return $nums;
        }

        //倒计时
        var time=parseInt({:strtotime(getKithe(14))-time()});
        function setTime(){
            $('#time').html(time+'秒');
            time--;
            setTimeout(setTime,1000);
        }
        //带天数的倒计时
        function countDown(times){
            var timer=null;
            timer=setInterval(function(){
                var day=0,
                    hour=0,
                    minute=0,
                    second=0;//时间默认值
                if(times > 0){
                    day = Math.floor(times / (60 * 60 * 24));
                    hour = Math.floor(times / (60 * 60)) - (day * 24);
                    minute = Math.floor(times / 60) - (day * 24 * 60) - (hour * 60);
                    second = Math.floor(times) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute * 60);
                }
                if (day <= 9) day = '0' + day;
                if (hour <= 9) hour = '0' + hour;
                if (minute <= 9) minute = '0' + minute;
                if (second <= 9) second = '0' + second;
                //
                $('.time').html(day+"天&nbsp;"+hour+"小时"+minute+"分"+second+"秒");
                times--;
            },1000);
            if(times<=0){
                clearInterval(timer);
            }
        }
        countDown(time);
    })

</script>
</body>
</html>